{
	"variables": {
		"iso_url": "https://mirrors.kernel.org/archlinux/iso/2015.05.01/archlinux-2015.05.01-dual.iso",
		"iso_checksum": "84387d095141ac2a4fd8c83ca0908ffa543a1d3b",
		"iso_checksum_type": "sha1",
		"version": "0.1.0+2015.05.9",
		"vagrant_cloud_token": "{{env `VAGRANT_ACCESS_TOKEN`}}"
	},
	"builders": [{
		"type": "qemu",
		"iso_url": "{{user `iso_url`}}",
		"iso_checksum": "{{user `iso_checksum`}}",
		"iso_checksum_type": "{{user `iso_checksum_type`}}",
		"http_directory": "arch",
		"shutdown_command": "systemctl start poweroff.timer",
		"ssh_username": "root",
		"ssh_password": "vagrant",
		"disk_size": 40000,
		"boot_wait": "5s",
		"qemuargs": [
			["-drive", "file=output-qemu/packer-qemu.qcow2,if=virtio,media=disk,aio=native,discard=unmap,index=0"],
			["-drive", "file=/usr/share/ovmf/x64/ovmf_code_x64.bin,if=pflash,format=raw,unit=0,readonly=on"],
			["-drive", "file=./files/qemu/efi/pc_vars.bin,if=pflash,format=raw,unit=1"]
		],
		"boot_command": [
			"<enter><wait10><wait10>",
			"curl -o /etc/pacman.conf http://{{.HTTPIP}}:{{.HTTPPort}}/pacman.conf<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/prepare-machine.sh<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/install-stage-1.sh<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/poweroff.timer<enter><wait>",
			"DISK=/dev/vda bash ./prepare-machine.sh<enter>"
		]
	}, {
		"type": "virtualbox-iso",
		"iso_url": "{{user `iso_url`}}",
		"iso_checksum": "{{user `iso_checksum`}}",
		"iso_checksum_type": "{{user `iso_checksum_type`}}",
		"guest_os_type": "ArchLinux_64",
		"guest_additions_mode": "disable",
		"http_directory": "arch",
		"shutdown_command": "systemctl start poweroff.timer",
		"ssh_username": "root",
		"ssh_password": "vagrant",
		"disk_size": 40000,
		"boot_wait": "5s",
		"boot_command": [
			"<enter><wait10><wait10>",
			"curl -o /etc/pacman.conf http://{{.HTTPIP}}:{{.HTTPPort}}/pacman.conf<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/prepare-machine.sh<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/install-stage-1.sh<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/poweroff.timer<enter><wait>",
			"DISK=/dev/sda bash ./prepare-machine.sh<enter>"
		]
	}, {
		"type": "vmware-iso",
		"iso_url": "{{user `iso_url`}}",
		"iso_checksum": "{{user `iso_checksum`}}",
		"iso_checksum_type": "{{user `iso_checksum_type`}}",
		"http_directory": "arch",
		"boot_wait": "5s",
		"shutdown_command": "systemctl start poweroff.timer",
		"boot_command": [
			"<enter><wait10><wait10>",
			"curl -o /etc/pacman.conf http://{{.HTTPIP}}:{{.HTTPPort}}/pacman.conf<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/prepare-machine.sh<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/install-stage-1.sh<enter><wait>",
			"curl -O http://{{.HTTPIP}}:{{.HTTPPort}}/poweroff.timer<enter><wait>",
			"DISK=/dev/sda bash ./prepare-machine.sh<enter>"
		],
		"disk_size": 40000,
		"ssh_username": "root",
		"ssh_password": "vagrant",
		"shutdown_command": "systemctl start poweroff.timer"
	}],
	"provisioners": [{
		"type": "shell",
		"script": "vbox/configure.sh",
		"only": ["virtualbox-iso"],
		"execute_command": "echo 'vagrant' | {{ .Vars }} sudo -E -S sh '{{ .Path }}'"
	}],
	"post-processors": [{
		"type": "vagrant",
		"output": "packer_arch_{{.Provider}}.box"
	}, {
		"type": "vagrant-cloud",
		"access_token": "user `vagrant_cloud_token`",
		"box_tag": "casualjim/arch-base",
		"version": "{{user `version`}}"
	}]

}
